---
import Container from "./Container.astro";
---

<section id="quiz" class="py-24 bg-gray-50 dark:bg-gray-900 scroll-mt-24">
    <Container>
        <div class="max-w-2xl mx-auto text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-950 dark:text-white mb-4">
                Scopri il tuo percorso ideale
            </h2>
            <p class="text-gray-600 dark:text-gray-400">
                Rispondi a 3 semplici domande per capire quale programma di
                coaching fa per te.
            </p>
        </div>

        <div
            id="quiz-container"
            class="max-w-xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-100 dark:border-gray-700 relative overflow-hidden min-h-[400px]"
        >
            <!-- Step 1 -->
            <div
                class="quiz-step transition-all duration-500 ease-in-out absolute inset-0 p-8 flex flex-col justify-center"
                data-step="1"
            >
                <h3
                    class="text-xl font-semibold text-gray-950 dark:text-white mb-6"
                >
                    Qual è il tuo obiettivo principale?
                </h3>
                <div class="space-y-3">
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="dimagrimento"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Dimagrimento e Definizione</span
                        >
                    </button>
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="massa"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Aumento Massa Muscolare</span
                        >
                    </button>
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="salute"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Salute e Benessere Generale</span
                        >
                    </button>
                </div>
            </div>

            <!-- Step 2 -->
            <div
                class="quiz-step transition-all duration-500 ease-in-out absolute inset-0 p-8 flex flex-col justify-center translate-x-full opacity-0 pointer-events-none"
                data-step="2"
            >
                <h3
                    class="text-xl font-semibold text-gray-950 dark:text-white mb-6"
                >
                    Qual è il tuo livello di esperienza?
                </h3>
                <div class="space-y-3">
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="principiante"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Principiante (0-1 anni)</span
                        >
                    </button>
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="intermedio"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Intermedio (1-3 anni)</span
                        >
                    </button>
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="avanzato"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Avanzato (3+ anni)</span
                        >
                    </button>
                </div>
            </div>

            <!-- Step 3 -->
            <div
                class="quiz-step transition-all duration-500 ease-in-out absolute inset-0 p-8 flex flex-col justify-center translate-x-full opacity-0 pointer-events-none"
                data-step="3"
            >
                <h3
                    class="text-xl font-semibold text-gray-950 dark:text-white mb-6"
                >
                    Quanto tempo puoi dedicare all'allenamento?
                </h3>
                <div class="space-y-3">
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="poco"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >2-3 ore a settimana</span
                        >
                    </button>
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="medio"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >4-5 ore a settimana</span
                        >
                    </button>
                    <button
                        class="quiz-option w-full text-left p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition-colors group"
                        data-value="tanto"
                    >
                        <span
                            class="text-gray-700 dark:text-gray-300 group-hover:text-primary-700 dark:group-hover:text-primary-400 font-medium"
                            >Ogni giorno</span
                        >
                    </button>
                </div>
            </div>

            <!-- Result -->
            <div
                class="quiz-step transition-all duration-500 ease-in-out absolute inset-0 p-8 flex flex-col justify-center items-center text-center translate-x-full opacity-0 pointer-events-none"
                data-step="result"
            >
                <div
                    class="mb-6 p-4 bg-primary-100 dark:bg-primary-900/30 rounded-full text-primary-600 dark:text-primary-400"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke-width="1.5"
                        stroke="currentColor"
                        class="size-12"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                        ></path>
                    </svg>
                </div>
                <h3
                    class="text-2xl font-bold text-gray-950 dark:text-white mb-2"
                >
                    Analisi Completata!
                </h3>
                <p class="text-gray-600 dark:text-gray-400 mb-8">
                    In base alle tue risposte, il programma ideale per te è:
                </p>

                <div
                    id="result-program"
                    class="text-xl font-semibold text-primary-600 dark:text-primary-400 mb-8 p-4 border border-primary-200 dark:border-primary-800 rounded-xl bg-primary-50 dark:bg-primary-950/50 w-full"
                >
                    Caricamento...
                </div>

                <a
                    href="#pricing"
                    class="inline-flex items-center justify-center px-6 py-3 text-base font-medium text-white bg-primary-600 hover:bg-primary-700 rounded-full transition-colors duration-300"
                >
                    Inizia Ora
                </a>
                <button
                    id="restart-quiz"
                    class="mt-4 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 underline"
                >
                    Ricomincia il test
                </button>
            </div>
        </div>
    </Container>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("quiz-container");
        const steps = container.querySelectorAll(".quiz-step");
        const options = container.querySelectorAll(".quiz-option");
        const resultProgram = document.getElementById("result-program");
        const restartBtn = document.getElementById("restart-quiz");

        let currentStep = 1;
        let answers = {};

        function showStep(stepNumber) {
            steps.forEach((step) => {
                const stepIndex = step.getAttribute("data-step");

                if (stepIndex === "result" && stepNumber === "result") {
                    step.classList.remove(
                        "translate-x-full",
                        "opacity-0",
                        "pointer-events-none",
                    );
                    step.classList.add("translate-x-0", "opacity-100");
                } else if (stepIndex === stepNumber.toString()) {
                    step.classList.remove(
                        "translate-x-full",
                        "opacity-0",
                        "pointer-events-none",
                    );
                    step.classList.add("translate-x-0", "opacity-100");
                } else {
                    step.classList.add("opacity-0", "pointer-events-none");
                    // If step is less than current, move left, else move right (simple logic for now: just hide)
                    // To make it smoother, we can just toggle visibility classes.
                    // For simplicity in this vanilla script, let's just hide non-active ones.
                    if (step.classList.contains("translate-x-0")) {
                        step.classList.remove("translate-x-0");
                        step.classList.add("-translate-x-full"); // Move out to left
                    } else {
                        // Reset to right if it was not visible
                        // step.classList.add('translate-x-full');
                    }
                }
            });
        }

        function calculateResult() {
            // Simple logic mapping
            let program = "Coaching 1:1 Premium";

            if (answers["1"] === "salute" && answers["3"] === "poco") {
                program = "Programma Wellness Start";
            } else if (answers["1"] === "massa") {
                program = "Protocollo Ipertrofia";
            } else if (answers["1"] === "dimagrimento") {
                program = "Metodo Definizione Totale";
            }

            resultProgram.textContent = program;
        }

        options.forEach((option) => {
            option.addEventListener("click", (e) => {
                const value = option.getAttribute("data-value");
                const stepDiv = option.closest(".quiz-step");
                const stepNum = stepDiv.getAttribute("data-step");

                answers[stepNum] = value;

                // Transition to next step
                const currentStepEl = container.querySelector(
                    `.quiz-step[data-step="${currentStep}"]`,
                );
                currentStepEl.classList.remove("translate-x-0", "opacity-100");
                currentStepEl.classList.add(
                    "-translate-x-full",
                    "opacity-0",
                    "pointer-events-none",
                );

                if (currentStep < 3) {
                    currentStep++;
                    const nextStepEl = container.querySelector(
                        `.quiz-step[data-step="${currentStep}"]`,
                    );
                    nextStepEl.classList.remove(
                        "translate-x-full",
                        "opacity-0",
                        "pointer-events-none",
                    );
                    nextStepEl.classList.add("translate-x-0", "opacity-100");
                } else {
                    calculateResult();
                    const resultStepEl = container.querySelector(
                        `.quiz-step[data-step="result"]`,
                    );
                    resultStepEl.classList.remove(
                        "translate-x-full",
                        "opacity-0",
                        "pointer-events-none",
                    );
                    resultStepEl.classList.add("translate-x-0", "opacity-100");
                }
            });
        });

        restartBtn.addEventListener("click", () => {
            // Reset UI
            const resultStepEl = container.querySelector(
                `.quiz-step[data-step="result"]`,
            );
            resultStepEl.classList.remove("translate-x-0", "opacity-100");
            resultStepEl.classList.add(
                "translate-x-full",
                "opacity-0",
                "pointer-events-none",
            );

            // Reset all steps to initial state
            steps.forEach((step) => {
                const s = step.getAttribute("data-step");
                if (s === "1") {
                    step.classList.remove(
                        "-translate-x-full",
                        "opacity-0",
                        "pointer-events-none",
                    );
                    step.classList.add("translate-x-0", "opacity-100");
                } else {
                    step.classList.remove(
                        "-translate-x-full",
                        "translate-x-0",
                        "opacity-100",
                    );
                    step.classList.add(
                        "translate-x-full",
                        "opacity-0",
                        "pointer-events-none",
                    );
                }
            });

            currentStep = 1;
            answers = {};
        });
    });
</script>
