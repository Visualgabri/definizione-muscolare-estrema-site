---
import BrandLogo from "./BrandLogo.astro";
import Container from "./Container.astro";
import { button } from "@tailus/themer-button";
import { cn } from "@lib/utils";

const links = [
  { to: "/", label: "Home" },
  { to: "/metodo", label: "Metodo" },
  { to: "/servizi", label: "Servizi" },
  { to: "/risultati", label: "Risultati" },
  { to: "/contatti", label: "Contatti" },
];
---

<header>
  <nav class="absolute z-50 w-full lg:bg-transparent dark:lg:bg-transparent">
    <Container>
      <div
        class="relative flex flex-wrap items-center justify-between gap-6 py-3 md:gap-0 md:py-4 lg:py-8"
      >
        <div
          class="relative z-[100] flex w-full items-center justify-between md:px-0 lg:w-max"
        >
          <BrandLogo />

          <div class="relative flex max-h-10 items-center lg:hidden">
            <button
              aria-label="hamburger"
              id="hamburger"
              class="relative -mr-6 p-6 active:scale-95 transition-transform"
            >
              <div
                aria-hidden="true"
                id="line"
                class="m-auto h-0.5 w-5 rounded bg-sky-900 transition duration-300 dark:bg-gray-300"
              >
              </div>
              <div
                aria-hidden="true"
                id="line2"
                class="m-auto mt-2 h-0.5 w-5 rounded bg-sky-900 transition duration-300 dark:bg-gray-300"
              >
              </div>
            </button>
          </div>
        </div>

        <!-- Mobile Menu Overlay (Full Screen) -->
        <div
          id="navLayer"
          class="fixed inset-0 z-[90] bg-white dark:bg-gray-950 flex flex-col items-center justify-center gap-8 opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
        >
          <ul
            class="flex flex-col gap-6 text-center text-2xl font-medium tracking-wide text-gray-700 dark:text-gray-200"
          >
            {
              links.map((link) => (
                <li>
                  <a
                    href={link.to}
                    class="block py-2 hover:text-sky-600 dark:hover:text-sky-400 transition-colors"
                  >
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
          <div class="mt-4">
            <a href="/#contatti" class={cn(button.neutral.lg, "w-full")}>
              Richiedi consulenza
            </a>
          </div>
        </div>

        <!-- Desktop Menu -->
        <div class="hidden lg:flex items-center gap-8">
          <ul
            class="flex gap-8 text-sm font-medium tracking-wide text-gray-700 dark:text-gray-200"
          >
            {
              links.map((link) => (
                <li>
                  <a
                    href={link.to}
                    class="hover:text-sky-600 dark:hover:text-sky-400 transition-colors"
                  >
                    {link.label}
                  </a>
                </li>
              ))
            }
          </ul>
          <a href="/#contatti" class={cn(button.neutral.sm)}>
            Richiedi consulenza
          </a>
        </div>
      </div>
    </Container>
  </nav>
</header>

<script>
  const hamburger = document.getElementById("hamburger");
  const navLayer = document.getElementById("navLayer");
  const links = document.querySelectorAll("#navLayer a");

  function toggleMenu() {
    if (!navLayer || !hamburger) return;

    const isOpen = !navLayer.classList.contains("opacity-0");

    if (isOpen) {
      // Close
      navLayer.classList.add("opacity-0", "pointer-events-none");
      document.body.classList.remove("overflow-hidden");

      // Hamburger reset
      const lines = hamburger.querySelectorAll("div");
      lines[0].classList.remove("rotate-45", "translate-y-1.5");
      lines[1].classList.remove("-rotate-45", "-translate-y-1");
    } else {
      // Open
      navLayer.classList.remove("opacity-0", "pointer-events-none");
      document.body.classList.add("overflow-hidden");

      // Hamburger animate
      const lines = hamburger.querySelectorAll("div");
      lines[0].classList.add("rotate-45", "translate-y-1.5");
      lines[1].classList.add("-rotate-45", "-translate-y-1");
    }
  }

  if (hamburger) {
    hamburger.addEventListener("click", toggleMenu);
  }

  links.forEach((link) => {
    link.addEventListener("click", toggleMenu);
  });
</script>
